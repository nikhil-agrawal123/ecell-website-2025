"use client";
import React, { useState } from "react";

const WEEK_DAYS = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

export const EVENT_TYPES = {
  workshop: {
    title: "Workshop",
    color: "bg-violet-500/90 text-white"
  },
  mentorship: {
    title: "Mentorship",
    color: "bg-emerald-500/90 text-white"
  },
  competition: {
    title: "Competition",
    color: "bg-amber-500/90 text-white"
  },
  speaker: {
    title: "Speaker Session",
    color: "bg-sky-500/90 text-white"
  },
  networking: {
    title: "Networking",
    color: "bg-rose-500/90 text-white"
  }
};

export interface Event {
  title: string;
  type: keyof typeof EVENT_TYPES;
  time: string;
  location: string;
  description?: string;
}

type Events = Record<number, Event[]>;

function getDaysInMonth(year: number, month: number) {
  return new Date(year, month + 1, 0).getDate();
}

function monthName(month: number) {
  return new Date(0, month).toLocaleString(undefined, { month: "long" });
}

// Static events - max 2 per day with variety across categories
function getStaticEvents(year: number, month: number): Events {
  const events: Events = {
    2: [
      {
        title: "Startup Ideation Workshop",
        type: "workshop",
        time: "10:00",
        location: "Room 102, Old Academic Block",
        description: "Learn the fundamentals of startup ideation"
      },
      {
        title: "Founder Office Hours",
        type: "mentorship",
        time: "14:00",
        location: "E-Cell Space, Library Building",
        description: "Get mentorship from experienced founders"
      }
    ],
    5: [
      {
        title: "Pitch Competition",
        type: "competition",
        time: "11:00",
        location: "Seminar Hall",
        description: "Showcase your startup idea in 5 minutes"
      }
    ],
    8: [
      {
        title: "Industry Leader Session",
        type: "speaker",
        time: "15:00",
        location: "Conference Room, R&D Block",
        description: "Learn from industry experts"
      },
      {
        title: "Startup Mixer",
        type: "networking",
        time: "18:00",
        location: "E-Cell Space, Library Building",
        description: "Network with founders and investors"
      }
    ],
    12: [
      {
        title: "Business Model Canvas Workshop",
        type: "workshop",
        time: "10:30",
        location: "Room 102, Old Academic Block",
        description: "Design effective business models"
      }
    ],
    15: [
      {
        title: "Hackathon",
        type: "competition",
        time: "09:00",
        location: "Seminar Hall",
        description: "24-hour coding and innovation challenge"
      },
      {
        title: "Alumni Mentorship Session",
        type: "mentorship",
        time: "16:00",
        location: "Conference Room, R&D Block",
        description: "Get insights from successful alumni"
      }
    ],
    18: [
      {
        title: "Founder's Talk",
        type: "speaker",
        time: "14:00",
        location: "E-Cell Space, Library Building",
        description: "Inspiring journey of successful founders"
      }
    ],
    22: [
      {
        title: "Design Thinking Session",
        type: "workshop",
        time: "11:00",
        location: "Room 102, Old Academic Block",
        description: "Problem-solving through design thinking"
      },
      {
        title: "Industry Connect",
        type: "networking",
        time: "17:00",
        location: "Seminar Hall",
        description: "Connect with industry professionals"
      }
    ],
    25: [
      {
        title: "Case Study Challenge",
        type: "competition",
        time: "10:00",
        location: "Conference Room, R&D Block",
        description: "Solve real-world business challenges"
      }
    ],
    28: [
      {
        title: "Tech Entrepreneurship Talk",
        type: "speaker",
        time: "15:30",
        location: "Seminar Hall",
        description: "Building tech startups from scratch"
      },
      {
        title: "Technical Mentorship",
        type: "mentorship",
        time: "18:00",
        location: "E-Cell Space, Library Building",
        description: "Get technical guidance for your project"
      }
    ]
  };
  return events;
}

const Calendar: React.FC = () => {
  const today = new Date();
  const [year, setYear] = useState(today.getFullYear());
  const [month, setMonth] = useState(today.getMonth());
  const [selected, setSelected] = useState<number | null>(null);
  const [view, setView] = useState<'month' | 'list'>('month');
  const events = getStaticEvents(year, month);

  const handlePrev = () => {
    if (month === 0) {
      setMonth(11);
      setYear((y) => y - 1);
    } else setMonth((m) => m - 1);
    setSelected(null);
  };

  const handleNext = () => {
    if (month === 11) {
      setMonth(0);
      setYear((y) => y + 1);
    } else setMonth((m) => m + 1);
    setSelected(null);
  };

  const firstDayOfMonth = new Date(year, month, 1).getDay();
  const daysInMonth = getDaysInMonth(year, month);

  const cells: Array<{ day: number | null }> = [];
  for (let i = 0; i < firstDayOfMonth; i++) cells.push({ day: null });
  for (let d = 1; d <= daysInMonth; d++) cells.push({ day: d });
  while (cells.length % 7 !== 0) cells.push({ day: null });

  const allEventsList = Object.entries(events)
    .flatMap(([day, evs]) => evs.map(ev => ({ day: Number(day), ...ev })))
    .sort((a, b) => a.day - b.day || a.time.localeCompare(b.time));

  return (
    <div className="max-w-7xl mx-auto p-4">
      <div className="grid md:grid-cols-4 gap-6">
        {/* Sidebar */}
        <aside className="md:col-span-1 bg-gradient-to-br from-slate-800/90 to-slate-900/90 rounded-2xl p-5 text-white/95 shadow-xl border border-white/10 h-fit sticky top-4">
          <div className="flex items-center justify-between mb-5">
            <div>
              <h4 className="text-lg font-bold bg-gradient-to-r from-indigo-400 to-pink-400 bg-clip-text text-transparent">
                E-Cell Calendar
              </h4>
              <p className="text-xs text-white/70 mt-1">IIIT Delhi</p>
            </div>
          </div>

          <div className="flex items-center justify-between mb-5 pb-4 border-b border-white/10">
            <div className="text-lg font-bold text-white">
              {monthName(month)} {year}
            </div>
            <div className="flex gap-1.5">
              <button onClick={handlePrev} className="bg-white/10 hover:bg-white/20 px-2.5 py-1.5 rounded-lg transition-colors text-white/80 hover:text-white font-medium">‚óÄ</button>
              <button onClick={handleNext} className="bg-white/10 hover:bg-white/20 px-2.5 py-1.5 rounded-lg transition-colors text-white/80 hover:text-white font-medium">‚ñ∂</button>
            </div>
          </div>

          <div className="flex gap-2 mb-5">
            <button
              onClick={() => setView('month')}
              className={`px-3 py-2 rounded-lg font-semibold text-sm transition-all ${view === 'month'
                  ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg'
                  : 'bg-white/5 hover:bg-white/15 text-white/80'
                }`}
            >
              Month
            </button>
            <button
              onClick={() => setView('list')}
              className={`px-3 py-2 rounded-lg font-semibold text-sm transition-all ${view === 'list'
                  ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg'
                  : 'bg-white/5 hover:bg-white/15 text-white/80'
                }`}
            >
              List
            </button>
          </div>

          {/* Event categories */}
          <div className="mb-6 pb-5 border-b border-white/10">
            <h5 className="text-xs font-bold mb-3 text-white/90 uppercase tracking-wide">Categories</h5>
            <div className="space-y-2.5">
              {Object.entries(EVENT_TYPES).map(([key, { title, color }]) => (
                <div key={key} className="flex items-center gap-3">
                  <div className={`w-2.5 h-2.5 rounded-full ${color} shadow-md`}></div>
                  <span className="text-sm text-white/80">{title}</span>
                </div>
              ))}
            </div>
          </div>

          {/* Upcoming events */}
          <div>
            <h5 className="text-xs font-bold mb-3 text-white/90 uppercase tracking-wide">Upcoming</h5>
            <div className="space-y-2.5 max-h-[320px] overflow-y-auto pr-2">
              {allEventsList.slice(0, 6).map((ev, i) => (
                <div key={i} className="bg-white/8 rounded-lg p-3 hover:bg-white/12 transition-all border border-white/10">
                  <div className={`text-xs font-bold mb-1 ${EVENT_TYPES[ev.type].color.replace('bg-', 'text-').replace('/90', '/80')}`}>
                    {EVENT_TYPES[ev.type].title}
                  </div>
                  <div className="text-sm font-medium text-white/95 truncate">
                    {ev.title}
                  </div>
                  <div className="text-xs text-white/70 mt-1.5">
                    {monthName(month)} {ev.day} ‚Ä¢ {ev.time}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </aside>

        {/* Calendar area */}
        <section className="md:col-span-3 bg-gradient-to-br from-slate-800/90 to-slate-900/90 rounded-2xl p-6 text-white shadow-xl border border-white/10">
          <div className="mb-6 flex items-center justify-center">
            <div className="flex gap-3 items-center">
              <button onClick={handlePrev} className="bg-white/10 hover:bg-white/20 px-3 py-2 rounded-lg transition-colors text-white/80 hover:text-white font-bold">‚óÄ</button>
              <h2 className="text-3xl font-bold bg-gradient-to-r from-indigo-400 to-pink-400 bg-clip-text text-transparent min-w-[200px] text-center">
                {monthName(month)} {year}
              </h2>
              <button onClick={handleNext} className="bg-white/10 hover:bg-white/20 px-3 py-2 rounded-lg transition-colors text-white/80 hover:text-white font-bold">‚ñ∂</button>
            </div>
          </div>

          <div className="mb-4 text-center">
            <p className="text-sm text-white/70 font-medium">
              {allEventsList.length} events scheduled
            </p>
          </div>

          {view === 'list' ? (
            <div className="space-y-4">
              {allEventsList.length > 0 ? (
                allEventsList.map((ev, i) => (
                  <div key={i} className={`${EVENT_TYPES[ev.type].color} p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow`}>
                    <div className="font-semibold text-base">{ev.title}</div>
                    <div className="text-sm mt-2 text-white/90">
                      üìÖ {monthName(month)} {ev.day} ‚Ä¢ üïê {ev.time}
                    </div>
                    <div className="text-sm mt-1 text-white/90">
                      üìç {ev.location}
                    </div>
                    {ev.description && (
                      <div className="text-sm mt-3 text-white/85 border-t border-white/20 pt-3">
                        {ev.description}
                      </div>
                    )}
                  </div>
                ))
              ) : (
                <div className="text-center py-12">
                  <p className="text-white/50 text-lg">No events scheduled this month</p>
                </div>
              )}
            </div>
          ) : (
            <>
              <div className="grid grid-cols-7 gap-1 text-center mb-4">
                {WEEK_DAYS.map((d) => (
                  <div key={d} className="text-xs font-bold text-white/80 py-3 bg-white/5 rounded-lg">{d}</div>
                ))}
              </div>

              <div className="grid grid-cols-7 gap-1">
                {cells.map((c, i) => (
                  <div
                    key={i}
                    onClick={() => c.day && setSelected(c.day)}
                    className={`
                      min-h-[9rem] p-2 rounded-lg cursor-pointer 
                      ${c.day ? 'bg-white/5 hover:bg-white/8' : 'bg-transparent'} 
                      ${c.day && selected === c.day ? 'ring-2 ring-indigo-500 bg-white/10' : ''}
                      transition-all flex flex-col justify-start border border-white/5
                    `}
                  >
                    <div className="flex justify-between items-start mb-2 w-full">
                      <div className={`
                        text-base font-semibold 
                        ${c.day === today.getDate() && month === today.getMonth() && year === today.getFullYear()
                          ? 'bg-gradient-to-r from-indigo-400 to-pink-400 bg-clip-text text-transparent'
                          : 'text-white/90'
                        }
                      `}>
                        {c.day ?? ''}
                      </div>
                      {c.day && events[c.day] && (
                        <div className="text-xs text-white/80 bg-white/15 px-2 py-0.5 rounded-full font-medium">
                          {events[c.day].length}
                        </div>
                      )}
                    </div>

                    <div className="flex flex-col gap-1.5 flex-1">
                      {c.day && events[c.day]?.map((ev, idx) => (
                        <div
                          key={idx}
                          title={ev.title}
                          className={`${EVENT_TYPES[ev.type].color} text-[0.65rem] px-2 py-1.5 rounded-md truncate shadow-md hover:shadow-lg transition-shadow font-medium`}
                        >
                          {ev.time}
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </>
          )}

          {/* Selected day view */}
          {selected && (
            <div className="mt-4 bg-white/5 p-4 rounded-lg border border-white/10">
              <div className="flex items-center justify-between mb-3">
                <h4 className="font-semibold text-lg bg-gradient-to-r from-indigo-400 to-pink-400 bg-clip-text text-transparent">
                  Events on {monthName(month)} {selected}
                </h4>
                <button
                  onClick={() => setSelected(null)}
                  className="text-sm text-white/70 hover:text-white/90 transition-colors"
                >
                  Close
                </button>
              </div>
              {events[selected]?.length > 0 ? (
                <div className="space-y-3">
                  {events[selected].map((ev, i) => (
                    <div key={i} className={`${EVENT_TYPES[ev.type].color} p-3 rounded-lg shadow-lg`}>
                      <div className="font-medium">{ev.title}</div>
                      <div className="text-sm mt-1">{ev.time}</div>
                      <div className="text-xs mt-0.5 text-white/90">{ev.location}</div>
                      {ev.description && (
                        <div className="text-xs mt-2 text-white/80 border-t border-white/10 pt-2">
                          {ev.description}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              ) : (
                <div className="text-center py-8">
                  <p className="text-white/50">No events scheduled for this day</p>
                </div>
              )}
            </div>
          )}
        </section>
      </div>
    </div>
  );
};

export default Calendar;